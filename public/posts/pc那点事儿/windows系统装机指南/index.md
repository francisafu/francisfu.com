# Windows系统装机指南


Windows 11到现在也已经来到了24H2版。恰好这几天给自己新配的电脑安装了系统，在这里我也更新一下八年前的这篇教程，给大家介绍一下Windows 11装机的全过程。  

<!--more-->

## 1.准备工作

>提醒下准备重装系统的朋友们：  
>在安装系统之前，一定要备份数据，以防止数据遗失。

如果你的电脑正在运行Windows 11，那么可以忽略这一段直接看下一段。如果正在运行Windows 10，想要升级Windows 11，那你需要先在[这个链接](https://aka.ms/GetPCHealthCheckApp)下载”电脑健康状况检查应用“来评估你的硬件是否满足安装Windows 11的最低要求。如果不满足的话就只能继续使用Windows 10，无法升级。只有满足最低要求才可以升级到Windows 11。

## 2.镜像制作

首先，要下载系统镜像制作启动U盘。点击[这个页面](https://www.microsoft.com/zh-cn/software-download/windows11)，在页面下方你会看到一个
”下载适用于 x64 设备的 Windows 11 磁盘映像 (ISO)“。在下拉框里选择”Windows 11（适用于 x64 设备的多版本ISO）“，然后点击蓝色的”立即下载“按键。

等待数秒后，弹出”选择产品语言“，这里我们选择这样”简体中文“，然后点击”确认“。再过数秒，页面会弹出”下载 - Windows 11 简体中文“，下方有一个蓝色的按键，上面写着”64-bit Download“。单击这个蓝色的按键，可以下载到一个Windows 11的ISO镜像。

第二步是在[这个页面](http://rufus.ie/)下载Rufus，这是一款开源的免费启动盘制作工具。下载版本推荐选择”Windows x64 便携版“。在打开Rufus之前，请在电脑上插入要作为启动盘的U盘。对于Windows 11来说，必须至少是16G的U盘，而且需要是空U盘，因为下一步会将其格式化。

打开Rufus后会自动检测USB设备。如果你插有多个U盘，一定注意不要弄错了盘符避免误删重要数据。引导类型保持默认的”镜像文件“，点击右侧的”选择“，找到并选择之前下载的Windows 11 ISO镜像。在扫描镜像后，Rufus会自动适配默认选项，均保持默认即可。

![Rufus](/images/PC那点事儿/Windows系统装机指南/Rufus.png)
<center>Rufus</center>

最后单击”开始“，程序就会刷写U盘。待上述操作结束后，关闭Rufus，你就拥有了一个Windows 11启动盘。至此，已经完成了所有的准备工作，可以开始装机了。 

## 3.装机进程

### 3.1 引导设置

一般来说我们大部分人的电脑默认都是 ”硬盘 —> USB“ 这样的引导顺序。所以在使用U盘重装系统时必须先修改BIOS，设置为U盘在硬盘之前的引导顺序。

首先点击桌面下方的”开始“图标，点击”设置“，选择”Windows 更新“。之后选择”高级选项“ —> ”恢复“，点击”高级启动“对应的右侧”立即重新启动“按键，重启电脑进入高级设置。

选择下方的”疑难解答“，进入后点击”高级选项“。之后选择最后的”UEFI固件设置“。进入后，点击”重启“，等待电脑重启后就会自动进入BIOS了。

如果系统已经崩溃无法正常进入了，或者是还没有安装系统，那么就在开机后一直连续按键盘上的 <kbd>Del</kbd> 键，也可以进入BIOS。

进入BIOS后就可以修改引导顺序了。注意，在进入BIOS之前首先要插入刚刚制作好的启动U盘。进入BIOS后只需将U盘引导设置为第一顺位即可，无需做其他更改，保存并退出重启。  

这部分如果有不太明确的，可以在百度上搜索”如何设置U盘引导“。因为每个主板的设置方式都不太一样，这个设置的难度也比较低，我就不具体展开说了，自行百度即可。

### 3.2 安装系统

如果看到了系统安装的深蓝色界面，说明到这一步成功了。 

> 这里可能会遇到一个问题，即无法进入安装引导，也不能正常进入系统，提示”Secure Boot Violation“。  
> 只需要重启电脑，不断按 <kbd>Del</kbd> 键再次进入BIOS后，在”Security“页面关闭”Secure Boot“即可。  

第一个页面保持默认的”中文-微软拼音“不变，第二个页面点击”现在安装“，跳到第三个页面会提示你输入激活码。此时点击”我没有产品密钥“即可，我们会在安装好系统之后激活。  
在下一个页面中选择”Windows 11专业版“，同意许可条款，接下来选择”自定义：仅安装 Windows（高级）“。接下来的界面需要选择要将系统安装到的硬盘。

> 这里可能会遇到另一个问题，即磁盘选择器里面是空的，看不到任何可以选择的磁盘。  
> 这主要是因为英特尔CPU对应的主板上面启用了VMD技术和IRST技术，而Windows 11原版安装镜像中缺少对应的驱动程序。  
> 仍然需要重启电脑进入BIOS，在 ”Advanced“ 页面关闭 ”VMD Controller“ 和 ”Intel(R) Rapid Storage Technology“ 即可。

在安装硬盘界面选择你要安装系统的C盘。这里可以使用”新建“和”格式化“功能建立分区。注意，在建立分区时输入的数值单位是MB，如按照GB计算，需要乘1024转换。比如需要建立500GB分区则为500x1024=512000MB。建议C盘空间至少为200GB。分区结束后，点击”下一步“就会自动开始安装系统。

原则上我们的安装过程到这里已经结束了，后面一直”下一步“就行。在安装系统过程中还会要求输入一些信息，比如语言、输入法、账号等，根据实际情况填写就好，基本没什么难度。

### 3.3 系统激活

安装好并进入系统后，点击桌面下方的”开始“图标，点击”设置“，选择”系统“-”激活“。在这里可以输入序列号进行系统激活。序列号的话，Windows 11专业版市售价1799元，建议购买正版。  

**注意！！下述内容仅供学习交流、经验分享之用，切勿用于实践！！**  
**本文作者不对任何在阅读本文之后进行的违反《中华人民共和国著作权法》、《计算机软件保护条例》等相关法律的行为承担直接或者连带责任！！**

> 其他获得序列号的途径还有X宝，直接搜索”Win11序列号“，10-20元就可以买到。不用担心不能用，都是真的。  
> 它们只不过是厂家专用版的而已，不是个人零售版的，但是实际二者没有区别。解释起来比较复杂，放心用就好。  
> 另外，不要购买可以多次激活使用的，用一次买一次就好，可以多次使用的那种你会发现，等到你下次要装机的时候都找不到了，到时候还要再重新买。

## 4.收尾工作

### 4.1 驱动程序

经历前面的步骤我们的电脑已经基本可以使用了。驱动的话现在Windows 11官方驱动库里基本包含了常见硬件的驱动包，不需要额外自行下载。但是仍然有部分小众硬件或者专有硬件的驱动没有覆盖，需要自行安装。最常见的就是显卡了。我目前只推荐从官方网站上下载安装驱动程序。

打开资源管理器，右键单击”此电脑“，点击”管理“-”设备管理器“。默认如果硬件驱动都安装正常，则条目不会展开。如有自动展开的条目，仔细查看左侧小图标，缺少驱动的硬件对应的图标右下角会有一个黄色的警告图标（三角形里面有个感叹号）。针对性的安装该硬件驱动程序即可。

> 对于笔记本：很多OEM厂商提供官方的驱动程序安装源，你只需要下载所有的对应型号和对应系统的驱动程序包然后依次安装。有的厂商提供驱动下载器，你也只需按要求操作即可。  
> 对于台式机：在主板官网查找对应的主板型号，下载Windows 11版本硬件驱动安装即可。

![主板驱动](/images/PC那点事儿/Windows系统装机指南/主板驱动.png)
<center>微星B650M Mortar主板官网驱动下载</center>
  
对于独立显卡驱动，一定记得：

**必须在英伟达或AMD官网下载独显驱动！！**  

英伟达显卡用户[在这里](https://www.nvidia.cn/software/nvidia-app/)下载Nvidia App。

AMD显卡用户[在这里](https://www.amd.com/zh-hans/support)下载AMD Adrenalin。

在这两款软件中可以对应的下载自己电脑独立显卡的最新驱动程序。 

### 4.2 系统设置

#### 4.2.1 桌面设置

进入系统之后第一件事应该是调整画面和显示的相关设置。目前Windows 11通常可以较好的识别并匹配屏幕分辨率。如果分辨率有误，桌面上 *右键——显示设置* 可以调整显示器分辨率和缩放。

在 *个性化——主题——桌面图标设置* 里面可以选择需要出现在桌面上的系统图标。

屏幕下方”开始“图标旁边可以看到长长的搜索框，如果你不需要，可以在任务栏上 *右键——任务栏设置——搜索——隐藏* 。在这里也可以关闭屏幕左下角的”小组件“，如果你也不用的话。这样能让你的任务栏看起来更整洁。

随便打开一个文件夹，在工具栏里面点击 *查看——显示* ，勾选”文件扩展名“和”隐藏的项目“，有利于日常反病毒。

工具栏最右侧有个省略号（三个点）的图标，点击它，选择”选项“，在对话框最上方有一个”打开文件资源管理器时打开“，建议设置为”此电脑“，比较符合国人的使用习惯。取消”隐私“栏目里面的三个对勾，点击”清除“删除历史记录。这样有利于个人隐私的保护。

#### 4.2.2 高级优化

**下面的设置较为高级，有一定计算机基础的朋友可以尝试。**   

1. 关闭快速启动  
    
    快速启动是Windows 10开始引入的技术，会让系统启动速度非常快，因为系统在关机的时候其实并没有真的“关闭计算机”，而是将当前系统状态（内存数据）转移到硬盘的一个文件中，之后休眠计算机。下次启动的时候，直接唤醒计算机，然后读取这个文件，所以启动速度会很快。但是这样会带来一些问题，例如关机不彻底、内存数据遗失，等等。可以将它关闭来还原最初的开关机逻辑。因为现在系统盘基本上都是固态硬盘，即使使用原始开关机方法，启动速度也不会很慢。

    关闭方法很简单，打开开始菜单，直接输入”cmd“，在搜索到的”命令提示符“上 *右键——以管理员身份运行* ，输入命令：`powercfg -h off` 并回车确认。如果后续想要恢复快速启动，只需将命令改成 `powercfg -h on` 就好了。

2. 关闭NDU服务  
    
    NDU服务（Windows Network Data Usage Monitoring Service）是微软用来检测网络数据流量的一个服务，它被爆出有严重BUG，会造成大量内存泄漏，但至今都未修复。所以推荐关闭这项服务，防止内存泄漏问题。

    关闭方法也很简单，还是打开开始菜单，直接输入”cmd“，在搜索到的”命令提示符“上 *右键——以管理员身份运行* ，输入命令：`sc config ndu start= disabled` 并回车确认。

3. 关闭内存完整性
   
   内存完整性是微软新推出的一项功能，旨在将程序运行在虚拟化的内存上，使系统免于受到内存地址级别的攻击导致安全问题。它的设计初衷是好的，但是实际情况是会导致程序的运行性能受到一定程度的影响，特别是一些大型游戏，重则导致蓝屏死机、卡顿崩溃，轻则性能损失导致掉帧8%~10%。

   关闭方法是，在桌面右下角找到”Windows安全中心“，图标是一个蓝色的小盾牌，打开它，单击”设备安全性“，然后单击“内核隔离详细信息”，关闭“内存完整性”即可。

   ![内存完整性](/images/PC那点事儿/Windows系统装机指南/内存完整性.png)
   <center>关闭内存完整性</center>

4. 关闭基于虚拟化的安全性
   
   跟内存完整性一样，也是微软新推出的技术，原理也基本一致，利用Windows 11自带的Hyper-V功能虚拟硬件，使程序运行在“沙盒”之中，防止硬件级别的攻击篡改。代价也是性能的损失。

   关闭它的方法较为复杂。首先需要在[这个链接](https://www.microsoft.com/en-us/download/details.aspx?id=53337)单击蓝色的“Download”按键下载“Device Guard and Credential Guard hardware readiness tool”，下载完成应该是一个压缩包，名为“dgreadiness_v3.6.zip”。解压它，然后打开开始菜单，直接输入”powershell“，在搜索到的”Windows PowerShell“上 *右键——以管理员身份运行* ，输入命令`set-ExecutionPolicy RemoteSigned`并按回车。命令行会提示你输入字母“Y”以确认，此时输入“Y”并按回车确认。接下来，在解压好的文件夹中找到“DG_Readiness_Tool_v3.6.ps1”文件，*右键——属性* ，复制“位置”那一行的内容。 

   ![虚拟化](/images/PC那点事儿/Windows系统装机指南/虚拟化.png)
   <center>关闭基于虚拟化的安全性</center>

   之后回到刚才的PowerShell窗口，继续输入`cd `，在后面粘贴刚才复制的路径，之后按回车进入该路径。
  
   例如，复制的路径是“C:\Users\abc\Downloads\dgreadiness_v3.6”，那么这里应该输入的命令是`cd C:\Users\abc\Downloads\dgreadiness_v3.6`。

   在进入脚本所在路径后，PowerShell窗口中输入命令`.\DG_Readiness_Tool_v3.6.ps1 -Disable`并按下回车，程序就会开始运行。等待运行完成后重启电脑，在重启过程中，根据提示需要先后按下 <kbd>F3</kbd> 按键两次，分别关闭Credential Guard和Device Guard。至此，基于虚拟化的安全性功能就被关闭了。

5. 关闭传递优化
   
   Windows更新传递优化是一项通过从其他设备获取更新资源来加速下载和分发Windows更新和应用程序的技术。它采用了类似P2P下载的思想，让用户之间共享更新文件，从而减轻了微软服务器的负担，提高了更新的效率。特别是在局域网环境下，该功能能够显著降低整个网络的更新带宽消耗。但是，它会影响用户的网速，拖慢整体网络情况。

   关闭它的方法是：点击桌面下方的”开始“图标，点击”设置“，选择”Windows更新“-”高级选项“。打开“其他选项”中的“传递优化”，关闭“允许从其他设备下载”即可

   ![传递优化](/images/PC那点事儿/Windows系统装机指南/传递优化.png)
   <center>关闭传递优化</center>

6. 开启存储感知
   
   存储感知是微软根据用户使用习惯，自动清理垃圾文件的功能。开启这个功能有益于释放磁盘空间。
   
   具体方法是：点击桌面下方的”开始“图标，点击”设置“，选择“系统”-“存储”-“存储感知”。勾选“清理临时文件”，
   开启“自动用户内容清除”，下方设置中，运行存储感知建议设置为“每天”或者“每周”，回收站和下载文件夹内容清理可以根据实际情况选择30天到从不。
   注意，这两个选项将直接影响回收站和下载文件夹，系统会根据设置的时间自动删除很早之前的文件，请谨慎设置！

   ![存储感知](/images/PC那点事儿/Windows系统装机指南/存储感知.png)
   <center>开启存储感知</center>

7. 开启高性能模式
   
   注意，这项设置仅用于台式机，笔记本电脑请勿设置，会导致耗电量急剧升高，续航下降明显。
  
   点击桌面下方的”开始“图标，点击”设置“，选择“系统”-“电源”。在“电源模式”右侧下拉框处选择“最佳性能”，展开下方“节电模式”，关闭“始终使用节电模式”。

   ![高性能模式](/images/PC那点事儿/Windows系统装机指南/高性能模式.png)
   <center>开启高性能模式</center>

8. 恢复经典右键菜单
   
   在Windows 11中，微软为了适配平板电脑以及二合一设备，对触屏做了很多优化，其中修改右键菜单样式就是一个。
   但是对于键鼠用户来说，新版的右键菜单十分难用，很多功能被隐藏在了二级菜单里，要多点击一下才能找到。

   如果想要恢复经典的右键菜单，可以通过这种方式：打开开始菜单，直接输入”cmd“，在搜索到的”命令提示符“上 *右键——以管理员身份运行* ，之后分别输入下面两条命令并回车确认。

   ```command
   reg add "HKCU\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\InprocServer32" /f /ve
   taskkill /f /im explorer.exe & start explorer.exe
   ```
   
   屏幕窗口会闪烁一下，之后右键菜单就恢复成经典样式了。

### 4.3 安装Office
 
订阅Office365一年只需要399元，家庭版499元。能用正版还是尽量支持正版，我希望有更多的人建立起版权意识。

**注意！！下述内容仅供学习交流、经验分享之用，切勿用于实践！！**  
**本文作者不对任何在阅读本文之后进行的违反《中华人民共和国著作权法》、《计算机软件保护条例》等相关法律的行为承担直接或者连带责任！！**

这里我给大家分享一个神器，叫”Office Tool Plus“，是由国人开发的强大Office辅助安装工具。    
在[官网](https://otp.landian.vip/zh-cn/)点击蓝色的”立即下载“按键会跳转到下载页面。任意选一所大学的镜像站，下载64位程序。
下载好是一个压缩包，解压到文件夹中，打开会看到”Office Tool Plus.exe“文件。双击启动它。  
打开它之后，什么都不用管，直接在键盘上按下<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>快捷键，界面上会弹出应用程序命令对话框。  
根据是否需要安装Visio，复制下面的两条命令之一粘贴进去，点击确定即可开始自动安装Office套件。

* 安装 Microsoft 365 企业应用版（仅Word, PowerPoint, Excel）
  ```
  deploy /add O365ProPlusRetail_zh-cn /O365ProPlusRetail.exclapps Access,Bing,Groove,Lync,OneDrive,OneNote,Outlook,Publisher,Teams /channel Current /dlfirst
  ```
* 安装 Microsoft 365 企业应用版（仅Word, PowerPoint, Excel）+ Visio 2016
  ```
  deploy /add "O365ProPlusRetail_zh-cn|VisioProRetail_zh-cn" /O365ProPlusRetail.exclapps Access,Bing,Groove,Lync,OneDrive,OneNote,Outlook,Publisher,Teams /VisioProRetail.exclapps Groove,OneDrive /channel Current /dlfirst
  ```
安装好后，再次按下<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>快捷键调出应用程序命令对话框，输入下面的两条命令任意一条粘贴进去，点击确定即可开始自动激活。
* KMS主机一
  ```
  ospp /inslicid MondoVolume /sethst:kms.loli.beer /setprt:1688 /act
  ```
* KMS主机二
  ```
  ospp /inslicid MondoVolume /sethst:kms.loli.best /setprt:1688 /act
  ```

## 5.结语
装机到此结束了。Enjoy it！  


---

> 作者: [Francis Fu](https://francisfu.com/)  
> URL: https://francisfu.com/posts/pc%E9%82%A3%E7%82%B9%E4%BA%8B%E5%84%BF/windows%E7%B3%BB%E7%BB%9F%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/  

