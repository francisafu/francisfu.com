# 魔趣安卓系统刷机教程


时间来到了2021年，贫困的我还在使用小米公司于2017年发布的小米6手机。电池续航严重跟不上趟，MIUI11系统在骁龙835下卡顿也非常明显。但是5.15寸的屏幕在大屏林立的今天实在是我这种手小的人的福音，多少还是不愿意换机。大概我就是雷总口中的米6钉子户吧。 

<!--more-->

但是手感再好也难掩系统的卡顿和频繁的死机，于是我决定做一把“搞机党”，为我的小米6刷上了国产ROM——魔趣系统。新系统使用极其流畅，续航也有大幅改观，在这里把刷机过程给大家分享一下，帮助手里有旧手机的朋友们挽救一下，兴许还能再战一年也未可知？  
>注意：以下内容全部以小米6手机为硬件对象，不保证其他手机的完美适配。目前魔趣ROM官方宣称可以适配大部分品牌的机型，具体支持手机型号列表可在[这个链接](https://download.mokeedev.com/)左侧栏目进行查看。据笔者所知，一加旗下诸多机型适配最好，小米/红米、魅族也基本可以完美适配，华为/荣耀适配范围较小。  
>注意：刷机有风险，玩机需谨慎！！机器有价，数据无价！！  

## 0.魔趣介绍
>魔趣 ROM 基于 Android 开源项目 (AOSP) 二次开发，所有的定制都遵循 Google 推出的 Material Design 设计语言，与原生 Android 界面保持着一致，这种定制方式降低了版本升级的难度。相比设备制造商迟缓、不积极的更新，魔趣 ROM 总能紧随 Google，早早为用户带来最新的 Android 系统。  
>本地化功能的缺失曾让许多钟情于原生 Android 的用户望而却步，魔趣 ROM 出色的本地化功能一经推出就获得了大量用户的青睐，让原生 Android 从此变得好用起来!  
>相比设备制造商臃肿的定制系统，魔趣 ROM 简单纯净，性能出众，使您能够更加轻松的使用设备。  

上面是[魔趣官网](https://www.mokeedev.com/guide/#rom-%E4%BB%8B%E7%BB%8D)对于自己的介绍，它是基于安卓开源代码的中国本地化改版，由国人团队开发维护，所有源码开源，有条件的朋友可以自行编译部署。其实对于刷机较多的朋友，可能感觉它和另一款著名开源ROM——CyanogenMod（CM）非常相似。团队表示是受了CM的启发，我个人认为早期版本可能使用了部分CM的源码。当然CM现在已经停止维护了，但是魔趣ROM社区仍然是很活跃的——得益于我国人口基数还是比较大的。
## 1.准备工作
刷机之前，请务必备份手机里所有重要的个人数据，包括但不限于：通讯录、照片、应用数据等。刷机过程中可能会双清或者四清导致全部个人数据被清空，所以一定一定做好备份！
## 2.手机解锁
现在不少手机是锁BootLoader的，BootLoader对于嵌入式设备（如ARM架构）而言类似于PC设备的BIOS。出于对设备安全性的考虑，厂商会锁定BootLoader以防止恶意程序或者不法分子篡改。那么如果我们要更换操作系统，第一步就是需要解锁BootLoader。小米手机的解锁请参考[这个页面](http://www.miui.com/unlock/download.html)，先下载手机解锁程序到电脑上，解压缩后，依次执行如下步骤：
1. 在电脑上打开小米手机解锁程序（miflash_unlock.exe）；
2. 同意条款，登录小米账户，进入待解锁界面；
3. 拿出手机，进入“设置 -> 我的设备 -> 全部参数”页面；
4. 这时连续点击MIUI版本号7次；
5. 直到手机屏幕提示已经处于开发者模式即可停止点击；
6. 进入“设置 -> 更多设置 -> 开发者选项 -> 设备解锁状态”中按照提示绑定账号和设备；
7. 手动进入Bootloader模式（先关机，然后同时按住开机键和音量下键，直到手机界面出现米兔画面和FASTBOOT字样）；
8. 通过USB连接手机，点击程序上的“解锁”按钮。
解锁过程中根据电脑情况可能会自动安装小米手机驱动，并且联网验证当前手机，所以需要保持电脑和手机的联网状态。另外，根据机型不同，程序会提示解锁操作是否会清空全部用户数据，请注意备份数据。  
解锁后手机会自动重启，如果解锁成功，在启动界面下方会出现一把打开的小锁头图标和“unlocked”字样。此时标志着第一步成功完成。
## 3.刷入Recovery
>Recovery是Android手机备份功能，指的是一种可以对安卓手机内部的数据或系统进行修改的模式（类似于windows PE或DOS）。在这个模式下可以，对已有的系统进行备份或升级，也可以在此恢复出厂设置。  

我们接下来要使用的是国际著名Recovery组织[TeamWin](https://twrp.me/)开发的大名鼎鼎的安卓Recovery——TWRP。小米6版可以在文后链接下载。下载工具并解压缩后，依次执行如下步骤：
1. 进入手机系统，清除系统密码（锁屏密码），将锁屏设置为无密码（如通过第三方软件加密了文件系统，请解密，否则刷机后可能会变砖）；
2. 手机进入BootLoader，方法：先关机，然后同时按住开机键和音量下键，直到手机界面出现米兔画面和FASTBOOT字样；
3. 之后将手机用数据线连接电脑；
4. 之后在解压的工具包里找到“一键刷入recovery(需要先解bl锁).bat”文件，双击打开；
5. 确保手机已经进入BootLoader（FASTBOOT）并连接电脑后，前两个界面按回车键继续；
6. 后续界面依次按照程序上半部分提示仔细核对程序下半部分的输出信息，如果一致，一路按回车键即可开始自动刷入Recovery。
7. 如果刷入成功，程序会提示“恭喜你成功导入了recovery！”，此时按回车键退出程序即可，手机会自动重启进入Recovery。
## 4.刷入系统
前面我们准备工作已经做的非常充分了，接下来就是正式刷入系统了。系统包下载地址在[这里](https://download.mokeedev.com/)，左侧列表中选取对应的手机品牌和支持的型号，右面会显示这部手机的相关参数和多个可供下载的版本。需要注意的是，魔趣ROM的开发团队在版本命名上很有趣，**“正式版”并不代表非常稳定的版本，“每夜版”也不是问题很多的意思**，换句话说，所谓的”正式版“不过是团队觉得当前大版本（安卓内核版本）已经基本没有更新升级的必要了，所以推出的一个当前大版本的最后发布版，而”每夜版“则是每天滚动更新的最新安卓内核版本对应的系统包。使用二者没差，所以推荐刷入当前最新的每夜版。  
### 4.1 文件下载
如果你只想向使用正常手机系统一样体验魔趣ROM，不想获取系统最高权限或者使用Google服务，或者你是小白，不明白这些都是什么意思，那么你只按照前述下载对应手机型号的ROM系统包即可。 

如果你希望获得系统最高权限（Root权限），那么请在[这里](https://download.mokeedev.com/extension.html)下载Magisk或者AddonSU。推荐使用Magisk（又叫”面具“），它是目前最好的Xposed框架代替品，由台湾大神开发，功能强大，并且网上方便好用的模块也非常多。AddonSU是魔趣团队开发的Root权限小工具，也可以实现Root功能，但是相对来说可玩性会小非常多。需要注意的是，二者只能安装一个，不能共存。 

如果你还需要Google服务，比如Google框架，用来运行一些游戏，那么请在前述页面下载OpenGApps，这是由开源团队制作的开源Google框架。需要注意的是，下载之前请先百度查询自己的手机是基于何种平台的，并确定自己要刷入的魔趣ROM所基于的安卓版本。说个小插曲，我下载之前想当然的下载了ARM版安卓10的，结果刷不进去，查了一下发现骁龙835是ARM64架构，犯了个低级错误。另外，类型建议选nano，nano是Google框架的最小可用精简版，包含了必备组件。pico版是超小残废精简版，只包含最小Google服务，很可能刷入后发现白给了，还是用不了。  
这里给出我的下载的组件套装：
1. MK100.0-sagit-202101050624-NIGHTLY
2. open_gapps-arm64-10.0-nano-20201223
3. Magisk-v21.2
相关文件在文章最后可以找到链接，魔趣官网服务器由于成本原因带宽很小，下载速度会非常感人，如果你需要的组件恰好和我一样，可以在文末链接下载（ROM包根据不同的机型是不一样的，非小米6用户请不要下载MK100那个文件。剩下两个组件是通用的）。
### 4.2 存储清理
趁文件下载的时间，我们可以开始下一步工作，清理手机内部存储。清存储的过程术语讲分三种，双清，四清，五清。如果前面你已经顺利刷入Recovery了，这时手机应该自动重启到Recovery界面。如果没有，那也没关系，先关机，然后同时按住音量上和电源键，出现MIUI logo的时候只松开电源键，继续按住音量上键，直到进入Recovery为止。  
**总结一下**
>进入BootLoader（FASTBOOT）：先关机，然后同时按住音量下和电源键，出现MIUI logo的时候只松开电源键，继续按住音量下键，直到出现米兔图案和FASTBOOT字样；  
>进入Recovery：先关机，然后同时按住音量上和电源键，出现MIUI logo的时候只松开电源键，继续按住音量上键，直到进入Recovery。 

出现蓝色的Recovery界面以后，他会询问你是否确定进入，向右滑动即可。进入后会看到八个大的功能模块，我们主要用到**安装**、**清除**和**重启**。  
首先点击**清除**模块，默认是双清，双清只会删除用户数据，不会移除原有系统。比较推荐使用这个模式。  
显示成功以后请点击返回，回到主菜单进行 **4.3** 中写的系统安装等工作。如果后续工作都正常进行，那么这个part接下来 **4.2.1** 中的内容就不需要看了。如果系统安装失败，那么请继续往下看，你可能需要做一个四清。
#### 4.2.1 高级清除
如果你在尝试 **4.3** 中的系统安装遇到了问题，那么你可以尝试进行四清，因为这可能说明双清对你的机器并不好用。具体操作是：  
首先进入Recovery主界面，然后点击**清除**模块，然后不要直接滑动，点击**高级清除**按键，勾选 **Dalvik/ART Cache** 选项和 **System** 选项。之后滑动清除。这就是四清。  
双清、四清和五清的区别如下：  
* 双清：先在Recovery界面，点击清除，此时下面有个滑动恢复出厂设置，这就是双清。相当于进入高级清除，勾选Data和Cache，该选项只会清除用户数据，不会删除原有系统，如果不刷入新系统，原有系统仍然可以使用；
* 四清：是在双清基础上清空了Dalvik/ART Cache（dalvik分区即虚拟内存）和System分区。 用户数据，原有系统都彻底清除，刷入的系统会更加稳定。（四清会把原来的系统全部删掉，如果你刷机失败是没法进入原来的系统，会变砖。可以通过adb导包来解决）；
* 五清：在上面勾选四个的情况下，再勾选内置存储（和外置U盘）。如果清除了，就需要重新导包，因为内置存储全部清空。五清可以理解为手机里所有东西都删掉了，除了还在运行的Recovery。整个手机重新来过。建议不要勾选，经常会出现各种难以预见的错误，建议最多四清。 
### 4.3 安装系统
双清（或四清）手机以后，这时如果需要的文件已经下载好了，那么请用数据线连接手机和电脑，将下好的文件压缩包拷贝到手机中。*注意一定不要解压！！一定原封不动的拷贝压缩包！！*  
拷贝好以后在Recovery主界面点击**安装**模块，在存储里先选择刚才拷贝的ROM包（文件名为MK...），向右滑动即可开始安装。*注意不要勾选签名校验和刷后重启，尤其是你还需要Root或者Google框架的时候*。  
安装顺利的话，在安装结束你会看到出现了 **Done** 字样。如果你不需要Root或者Google，那么你就可以返回Recovery主界面选择**重启**模块重启并享用丝滑的新系统了！如果需要，请继续向下看。
#### 4.3.1 谷歌框架
在Google框架和Magisk的刷入顺序上，我个人推荐先刷入Google。当然如果你不需要，也可以直接刷Magisk。顺利刷完系统之后返回Recovery主界面，选择**安装**模块，找到下载拷贝进来的OpenGApps压缩包，滑动安装即可。安装末尾可能会有一句错误码为1的报错，忽略它，它会不影响什么的，同样以出现 **Done** 字样为准。
#### 4.3.2 面具程序
刷完Google以后仍旧是返回Recovery主界面，选择**安装**模块，找到下载拷贝进来的Magisk压缩包，滑动安装即可。安装成功与否还是以出现 **Done** 字样为准（据我几次测试，一般这个步骤不会有什么问题）。
#### 4.3.3 失败处理
在第一步刷入系统ROM包的时候最容易出现各类错误导致刷机失败，最常见的是错误码为7（ErrorCode:7）的各种情形。在错误码这一行红字的上方一行”Exxxx:“开头的白字是具体的报错提示，最简单的办法就是记录下这行白字然后百度一下。基本上你能遇到的问题别人也都遇到过了，按照各路大神解决的办法处理就行。比如我遇到的是  
*”E3004:This package is for "Sagit" devices; this is a "".“*   
其中“Sagit”是小米6的内部代号，这个错误是说，我所使用的刷机包是给小米6准备的，但这部机器无法识别。这个问题常出现在四清之后，机器识别代码被移除了，刷机包无法通过校验。这里我附上解决办法：  
1. 在电脑上用解压缩工具打开压缩包（是打开不是解压！）；
2. 找到META-INF/com/google/android/updater-script文件。拖拽到桌面；
3. 用代码编辑器打开updater-script文件（建议用VS Code）,然后删除第一行，也就是这一行代码

```
getprop("ro.display.series") == "Sagit" || abort("E3004: This package is for \"Sagit\" devices; this is a \"" + getprop("ro.display.series") + "\".");
```

然后保存；   
4. 双击开始的安装包，再找到META-INF/com/google/android/updater-script文件，然后直接把修改后的updater-script拖到里面覆盖；
5. 将修改过的ROM包拷贝至手机重新安装即可。
至于如果你遇到的是其它类型的“错误7”，请自行百度搜索解决办法。
## 5.其他工作
顺利刷入系统后重启即可享用丝滑的系统，如果你刷入了Google框架，请注意第一次重启时不要插SIM卡或者连接WIFI，否则你可能无法跳过默认的Google账户登录。在完全离线的状态下谷歌是允许跳过该步骤的，联网情况则不行。当然如果你身处“某些地区”就当我没说。 

如果你刷入了Magisk，正式进入系统后请先联网，然后打开Magisk，这时它会提示你要安装Magisk软件，下载安装即可。因为之前我们刷入的是它的底层包，它需要配合上层应用一起使用。安装后你就可以纵情享受Root至高无上的权限了。Magisk的使用这里不多赘述，网上自行百度有好多奇技淫巧。  
我这里只说一个我认为比较有用的：全局字体。关注“宁静之雨”公众号，这是一个搞机达人小姐姐创办的，她是Magisk字体模块的高玩，公众号里有好多Magisk字体模块，下载后拷贝到手机中，用Magisk加载就可以享受被谷歌安卓开发小组阉割掉的“中文多字重显示”功能了，拥有苹果手机般美妙的字体渲染，你说它不香吗？喜欢的朋友可以自行下载并刷入体验。

